<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="doself.user.members.mapper.MembersMapper">
    <resultMap type="Members" id="membersResultMap">
		<id 	column="mbr_id" 			         property="memberId"/>
		<result column="mbr_pw" 			         property="oldMemberPw" />
		<result column="mbr_name" 			         property="memberName" />
		<result column="mg_code" 			         property="memberGrdCode" />
		<result column="mbr_email"			         property="memberEmail" />
		<result column="mbr_birth_date" 	         property="memberBrith" />
		<result column="mbr_phone_num" 		         property="memberPhoneNum" />
		<result column="mbr_gender" 		         property="memberGender" />
		<result column="ac_num" 			         property="memberAgeRange" />
		<result column="opening_ticket_count" 	   	 property="openTicketCnt" />
		<result column="participation_ticket_count"  property="partTicketCnt" />
		<result column="mbr_point" 	                 property="memberPoint" />
		<result column="mbr_image" 	                 property="memberImage" />
	</resultMap>
  		
  	<!-- 회원정보 -->	
    <select id="getMemberInfoById" parameterType="String" resultMap="membersResultMap">
        SELECT 
            mbr_id, 
            mbr_pw,
            mbr_name,
            mg_code,
            mbr_email, 
            mbr_birth_date, 
            mbr_phone_num,
            mbr_gender,
            ac_num,
            opening_ticket_count,
            participation_ticket_count,
            mbr_point,
            mbr_image
        FROM 
            member
        WHERE
            mbr_id = #{memberId};
    </select>
    
	<!-- 현재 비밀번호 확인 -->
	<select id="passwordChk" parameterType="map" resultType="boolean">
	    SELECT COUNT(*)
	    FROM member
	    WHERE 
	    mbr_id = #{memberId} AND mbr_pw = #{oldMemberPw}
	</select>
	
	<!-- 새 비밀번호 업데이트 -->
	<update id="updatePassword" parameterType="map">
	    UPDATE member
	    SET mbr_pw = #{newMemberPw}
	    WHERE mbr_id = #{memberId}
	</update>
	
	<update id="modifyMember" parameterType="Members">
       UPDATE member 
    <set>
        <if test="oldMemberPw != null and oldMemberPw !='' and newMemberPw != null and newMemberPw">
         mbr_pw = #{newMemberPw},</if>
        <if test="memberPhoneNum != null">
         mbr_phone_num = #{memberPhoneNum},</if>
        <if test="memberEmail != null">
         mbr_email = #{memberEmail}</if>
    </set>
       WHERE mbr_id = #{memberId};
</update>    
    
  </mapper>